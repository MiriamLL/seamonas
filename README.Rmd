---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# seamonas

<!-- badges: start -->
<!-- badges: end -->

The goal of seamonas is to provide tools to make plots of the North Sea

# Intro

Contains data:  
- Data from a random generated survey in CRS 3035 and CRS 4326   
- Data from random generated densities  
- A grid generated using the function create_grid in CRS 3035 

Contains functions for spatial analyses:  
- transform_survey  
- subset_grid  
- grid_densities  

Contains function to plot:  
- plot_density  
- add_breaks  
- add_legend  
- add_theme  



# Installation

You can install the development version of seamonas from [GitHub](https://github.com/) with:

```{r, eval=FALSE}
# install.packages("devtools")
devtools::install_github("MiriamLL/seamonas")
```

```{r example, eval=TRUE}
library('seamonas')
```

# Data

Data randomly generated to simulate surveys, density data and data on grids

## survey data

Data from a survey including longitude, latitude, timestamp

```{r, eval=FALSE}
survey_4326<-survey_4326
```

```{r}
head(survey_4326)
```

```{r}
ggplot2::ggplot()+
    ggplot2::geom_point(data=survey_4326,
                        ggplot2::aes(x=longitude, y= latitude, color=date),size = 1, shape = 16) 
```


## density survey

A data frame with survey data including observations, includes 2000 observations of 10 variables

```{r}
density_survey<-density_survey
```

```{r, eval=FALSE}
head(density_survey)
```

## density df


```{r,echo=FALSE, eval=FALSE}
## Create data frame
density_df<-data.frame(
             seq=(1:50),
             survey_id=rep(c(1, 2, 3, 4, 5), each = 10),
             longitude=c(seq(6, 8, length = 10),
                         seq(6, 8, length = 10),
                         seq(6, 8, length = 10),
                         seq(6, 8, length = 10),
                         seq(6, 8, length = 10)),
             latitude=c(seq(55.1,54, length = 10),
                        seq(55.1+0.1,54+0.1, length = 10),
                        seq(55.1+0.2,54+0.2, length = 10),
                        seq(55.1-0.2,54-0.2, length = 10),
                        seq(55.1-0.1,54-0.1, length = 10)),
             timestamps=c(
  head(seq.POSIXt(as.POSIXct("2018-04-01 09:00:00"), as.POSIXct("2018-04-01 18:00:00"), by="min"), 10),
  head(seq.POSIXt(as.POSIXct("2018-05-01 09:00:00"), as.POSIXct("2018-05-01 18:00:00"), by="min"), 10),
  head(seq.POSIXt(as.POSIXct("2018-06-01 09:00:00"), as.POSIXct("2018-06-01 18:00:00"), by="min"), 10),
  head(seq.POSIXt(as.POSIXct("2018-07-01 09:00:00"), as.POSIXct("2018-07-01 18:00:00"), by="min"), 10),
  head(seq.POSIXt(as.POSIXct("2018-08-01 09:00:00"), as.POSIXct("2018-08-01 18:00:00"), by="min"), 10))
)


density_df$year<-stringr::str_sub(density_df$timestamps, 1, 4)
density_df$month<-stringr::str_sub(density_df$timestamps, 6, 7)
density_df$day<-stringr::str_sub(density_df$timestamps, 9, 10)
density_df$date<-paste0(density_df$year,"-",density_df$month,"-",density_df$day)

#values 0 or 1
random1<-sample(0:1, 50, replace=TRUE)

#values 0 to 5.1

random2<-runif(50, min=0, max=5.1)

#make data frame

random3<-cbind(random1,random2)
random3<-as.data.frame(random3)


#substitute values
random4<-random3 %>%
  mutate(random5 = case_when(
    random1 == 0 ~ 0,
    random1 != 0 ~ random2,
    TRUE ~ random2))
#use as densities

density_df$densities<-as.numeric(random4$random5)

## Export
save(density_df, file = "density_df.RData", version = 2)
```

A data frame with survey data includes 50 observations of 10 variables

```{r}
density_df<-density_df
```

```{r}
head(density_df)
```


## grid 5x5

A grid 5x5 in CRS 3035

```{r}
grid5x5_3035<-grid5x5_3035
```

```{r,eval=FALSE, eval=FALSE}
plot(grid5x5_3035)
```

```{r}
head(grid5x5_3035)
```

## surveyed grid

The surveyed grid, this means the grid cells were data was collected

```{r, eval=FALSE}
grid_surveyed<-grid_surveyed
```

```{r}
head(grid_surveyed)
```

# Survey grid

Spatial functions to transform the data

## transform_survey

A function to transform data collected in latitude and longitude from degrees, transform from 4326 to 3035

```{r}
survey_3035<-transform_survey(survey_data=survey_4326,
                 column_latitude='latitude',
                 column_longitude='longitude',
                 from_CRS=4326,
                 to_CRS=3035)
```


## subset_grid

Add values to geometries of the grid, each square is a geometry or polygon
There will be warning that variables are assumed to be spatially constant throughout all geometries
Will print a plot and return the grids with data

```{r, eval=FALSE}
grid_surveyed<-subset_grid(survey_grid=grid5x5_3035,
                      survey_data=survey_3035,
                      grid_identifier='grid_id')
```


plot to check grid

```{r, fig.height=4}
ggplot2::ggplot()+
  ggplot2::geom_sf(data = grid_surveyed, colour = "#42a921", fill= '#bde0fe',alpha=0.9)+
  ggplot2::geom_sf(data = survey_3035)+
  NULL
```




# Densities grid

A series of functions to go from a data frame of surveyed data to a grid

## transform_survey

A function to transform the CRS

```{r}
densities_3035<-transform_survey(survey_data=density_survey, 
                 column_latitude='latitude',
                 column_longitude='longitude',
                 from_CRS=4326,
                 to_CRS=3035)
```

## grid_densities

A function to keep only grids with data

```{r,eval=FALSE}
density_grid<-subset_density(density_survey=densities_3035,column_density='densities',
                             survey_grid=grid_surveyed,grid_identifier='grid_id')
```


Check the data

```{r, fig.height=4}
ggplot2::ggplot()+
  ggplot2::geom_sf(data = density_grid,mapping = ggplot2::aes(fill = mean_density), lwd = 0, colour = NA)
```


# Plots

Functions to facilitate plotting on the same style

## plot_density

Base data

```{r}
my_CRS<-3035
Europa<-sf::st_transform(GermanNorthSea::German_land, my_CRS)
EEZ<-sf::st_transform(GermanNorthSea::German_EEZ, my_CRS)
color_land='#f7bf54'
color_water='#3668b4'
xval<-c(3910000,4250000)
yval<-c(3380000,3680000)
```

Provide density grid and mean densities

```{r}
density_plot<-ggplot2::ggplot()+
    # maps
    ggplot2::geom_sf(data = EEZ, colour = 'black', fill = color_water)+
    ggplot2::geom_sf(data = Europa, colour = 'black', fill = color_land)+
    ggplot2::geom_sf(data = density_grid,
                     mapping = ggplot2::aes(fill = mean_density), lwd = 0, colour = NA) + 
  ggplot2::coord_sf(xlim = xval, ylim = yval)+

    NULL
density_plot
```


## add_breaks

A function to add color palette and breaks in the legend, will vary with the species density estimates

```{r, eval=FALSE}
plot_wbreaks<-add_breaks(density_plot=density_plot,
                     legendbreaks=c(0,0.5,1,1.5,2.0),
                     legendlimits=c(0,2),
                     legendlabels=c('     0','   0.5','   1.0','   1.5','> 2.0'))
plot_wbreaks
```



## add_legend

A function to add the legend inside the plot

```{r, eval=FALSE}
plot_wlegend<-add_legend(
  plot_wbreaks=plot_wbreaks,
  legtx=3905000,
  legty=3510000,
  legxy=c(0.11, 0.21),
  xval=c(3910000,4250000),
  yval=c(3380000,3680000))
plot_wlegend
```


##  add_theme

A function to define the theme

```{r, eval=FALSE}
plot_wtheme<-add_theme(plot_wlegend = plot_wlegend)
plot_wtheme
```







