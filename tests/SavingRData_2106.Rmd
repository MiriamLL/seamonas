---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# ~~~~~~~~~~~~~~~~~~~~~~
# Euring

Contains data:  
- Euring data with taxonomic grouping  
Last update: Mar-2024  
Base information from November 2023 (https://euring.org/data-and-codes/euring-codes)  
Except 6169 was changed to 6159.

```{r, eval=FALSE, echo=FALSE}
# Correct after 2024, according to SQL data base
library(seamonas)
Code_Euring<-Code_Euring
## Check which code needs to be corrected
Code_Euring %>% filter(Code=='6169')
## Check that the code is not currently on use
Code_Euring %>% filter(Code=='6159')
## Substitute
Code_Euring$Code<-gsub('6169', '6159',Code_Euring$Code)
## Check that was correctly saved
Code_Euring %>% filter(Code=='6159')
# Check that it was removed
Code_Euring %>% filter(Code=='6169')
## Save
save(Code_Euring, file = "Code_Euring.RData", version = 2)
```

```{r, eval=FALSE, echo=FALSE}
library(seamonas)
Euring_codes1<-Code_Euring
Euring_codes1$English_name<-gsub("/", " / ",Euring_codes1$English_name) 

library(tidyverse)

library(readr)
#Euring_codes2a <- read_csv("data/SpeciesCodes2020_20231114_0.csv")
colnames(Euring_codes2a)<-c('Code','Scientific_name2','Updated_Date')
Euring_codes2b<-Euring_codes2a %>% select(Code,Scientific_name2)

library(readxl)
#Euring_codes3a<-read_excel("data/LKP_EURING.xlsx")
Euring_codes3b<-Euring_codes3a %>% select(CODE,SCIENTIFIC_NAME,ENGLISH_NAME)
Euring_codes3c<-Euring_codes3b %>% rename(Code=CODE, Scientific_name3=SCIENTIFIC_NAME,English_name3=ENGLISH_NAME)

Euring_codes4<-merge(Euring_codes1,Euring_codes2b,by='Code',all=TRUE)
Euring_codes5<-merge(Euring_codes4,Euring_codes3c,by='Code',all=TRUE)
Euring_codes5<-Euring_codes5 %>%
  select(Code,Scientific_name,Scientific_name2,Scientific_name3,English_name,English_name3)

Euring_codes6 <- Euring_codes5 %>%
  drop_na(Scientific_name3)

Euring_codes6 <- Euring_codes6 %>%
  mutate(Same_names=if_else(English_name == English_name3, "equal", "different"))
Euring_codes7<-Euring_codes6 %>%
  filter(Same_names=='different')
```

# ~~~~~~~~~~~~~~~~~~~~~~

# Taxonomic Group

```{r TaxonomicGroup, echo=FALSE, eval=TRUE}
ImportTaxonomicGroups<-function(Species){
Divers<-c("Black-throated Diver","Great Northern Diver","Red-throated Diver","unidentified diver")

#Combine cormorants and gannets
Cormorant_Gannets<-c("Great Cormorant","Great Cormorant/European Shag","Northern Gannet")

Anatidae<-c("Common Eider","Common Scoter","Eurasian Teal","Long-tailed Duck","Red-breasted Merganser","Eurasian Wigeon","Northern Shoveler","Velvet Scoter","unidentified duck","Mallard","Goosander","Common Pochard")

#Please move Mute Swan and Cmmon Shelduck to separate classification
Geese_Shelducks<-c("Brent Goose","Greylag Goose","Barnacle Goose","Canada Goose","Mute Swan","Common Shelduck")

Skuas<-c("Arctic Skua","Great Skua","Long-tailed Skua","Pomarine skua")

Auks<-c("Atlantic Puffin","Common Guillemot","Common Guillemot/Razorbill", "Razorbill","unidentified auk")

Grebes<-c("Great Crested Grebe","unidentified grebe","Black-necked Grebe","Red-necked Grebe")

Waders<-c("Eurasian Oystercatcher","European Golden Plover","Red Knot","unidentified wader","Whimbrel","Eurasian Curlew","Bar-tailed Godwit","Dunlin","Avocet","Northern Lapwing")

Gulls<-c("Black-headed Gull","Black-legged Kittiwake","Lesser Black-backed Gull","Little Gull","Small gull species","tern/small gull","unidentified gull","unidentified large gull","unidentified small gull","Common Gull" ,"Great / Lesser Black-backed Gull","Herring Gull","Great Black-backed Gull","fulmar/gull","Fulmar / gull species",
         #ADDED 2020
         "fulmar/gull","Little Gull","Great / Lesser Black-backed Gull","tern/small gull")

Terns<-c("Sandwich Tern","Common/Arctic Tern","unidentified tern","Tern / small gull","Common Tern","Little Tern")

OtherBirds<-c("Common Kestrel","Eurasian Sparrowhawk","Grey Heron","unidentified songbird","unidentified bird","Eurasian Marsh Harrier","Common Wood Pigeon","Common Coot","Feral Pigeon",
              #added 2021-11-02
              "Great Egret")

Mammals <- c("Grey Seal", "Harbour Porpoise" ,"Harbour Seal","Minke Whale","unidentified marine mammal","unidentified pinniped (Grey/Harbour Seal)","White-beaked Dolphin","White-sided Dolphin","Bottlenose Dolphin", "Common Dolphin","Risso's Dolphin","Killer Whale")

assign('Divers',Divers,envir=globalenv())
assign('Cormorant_Gannets',Cormorant_Gannets,envir=globalenv())
assign('Anatidae',Anatidae,envir=globalenv())
assign('Geese_Shelducks',Geese_Shelducks,envir=globalenv())
assign('Skuas',Skuas,envir=globalenv())
assign('Auks',Auks,envir=globalenv())
assign('Grebes',Grebes,envir=globalenv())
assign('Waders',Waders,envir=globalenv())
assign('Gulls',Gulls,envir=globalenv())
assign('Terns',Terns,envir=globalenv())
assign('OtherBirds',OtherBirds,envir=globalenv())
assign('Mammals',Mammals,envir=globalenv())
}
ImportTaxonomicGroups(Species)

Code_Euring$TaxGroups<-ifelse(Code_Euring$English_name %in% Divers, "Divers",
                        ifelse(Code_Euring$English_name %in% Cormorant_Gannets, "Cormorant_Gannets",
                        ifelse(Code_Euring$English_name %in% Anatidae, "Anatidae",
                        ifelse(Code_Euring$English_name %in% Geese_Shelducks, "Geese_Shelducks",
                        ifelse(Code_Euring$English_name %in% Skuas, "Skuas",
                        ifelse(Code_Euring$English_name %in% Auks, "Auks",
                        ifelse(Code_Euring$English_name %in% Grebes, "Grebes",
                        ifelse(Code_Euring$English_name %in% Waders, "Waders",
                        ifelse(Code_Euring$English_name %in% Gulls, "Gulls",
                        ifelse(Code_Euring$English_name %in% Terns, "Terns",
                        ifelse(Code_Euring$English_name %in% OtherBirds, "OtherBirds", 
                        ifelse(Code_Euring$English_name %in% Mammals, "Mammals","Not included yet"))))))))))))
```

```{r, eval=FALSE, echo=FALSE}
Euring2<-seamonas::classify_taxonomic(my_data=Code_Euring,col_name = "English_name")
```

```{r, echo=FALSE, eval=FALSE}
Code_Euring$TaxGroups[1:5]<-'Divers'
Code_Euring$TaxGroups[6:14]<-'Grebes'
Code_Euring$TaxGroups[15:33]<-'Other_seabirds'
Code_Euring$TaxGroups[34:40]<-'Gannets_Cormorants'
Code_Euring$TaxGroups[41:57]<-'Other_species'
Code_Euring$TaxGroups[58:83]<-'Swan_Geese'
Code_Euring$TaxGroups[84:126]<-'Ducks_Shelducks'
Code_Euring$TaxGroups[127:176]<-'Other_species'
Code_Euring$TaxGroups[177:236]<-'Waders'
Code_Euring$TaxGroups[237:243]<-'Skuas'
Code_Euring$TaxGroups[244:273]<-'Gulls'
Code_Euring$TaxGroups[274:288]<-'Terns'
Code_Euring$TaxGroups[289:296]<-'Auks'
Code_Euring$TaxGroups[297:528]<-'Other_species'
Code_Euring$TaxGroups[529:546]<-'Marine_mammals'
Code_Euring$TaxGroups[547:549]<-'Other_species'
```

```{r}
Euring_code<-seamonas::Code_Euring
head(Euring_code)
```


# ~~~~~~~~~~~~~~~~~~~~~~
# Survey data
# ~~~~~~~~~~~~~~~~~~~~~~

# Tripdaten

```{r}
library(tidyverse)
```

```{r}
TripDaten_test<-data.frame(TRIP=NA,
                       TRIP_ID='1',
                       Dataset_ID='1',
                       CRUISENO='AreaA_Summer_2025',
                       OWPAS='ClientName',
                       PROJECT='ProjectName',
                       CLUSTER='A',
                       LAB='CompanyName',
                       SCIENTIST='ResponsibleName',
                       DATATYPE='SeabirdMonitoring',
                       TECHNIQUE='Video',
                       OBSERVER='FlyingCompany',
                       PLANE='TypeOfPlane',
                       NUMBER_OF_PLANES=1,
                       DOUBLE_PLATFORM='No',
                       DATE='20250616',
                       STARTTIME='09:00:00',
                       ENDTIME='11:00:00',
                       CAMERA_SYSTEM='CameraSystemSpecifications',
                       RESOLUTION=2,
                       PLANE_FLIGHT_HEIGHT_PLANNED=540,
                       STRIP_WIDTH=400,
                       PLANE_SPEED=100,
                       POSITION_ACCURACY=50,
                       METHOD_ID=1,
                       AREA_OBSERVED=100,
                       AREA_ANALYSED=80,
                       AREA_CONTROLLED=25,
                       ID_CONTROLLED=300,
                       SCREENING_CONTROL_DIFFERENCE=15,
                       ID_CONTROL_DIFFERENCE=20,
                       QUALITY_IMPROVEMENT='Reassessment of species identification when observer had biases in auks',
                       POSITIONSYSTEM='GPS',
                       POSIT_PRECISION_CODE=1,
                       REFSYSTEM='WGS84',
                       NOTES=NA
                       )
```


## Quality Checks
### Survey Info

```{r StripWidth, echo=FALSE}
Survey_names<-unique(TripDaten_test$CRUISENO)
Survey_dates<-unique(TripDaten_test$DATE)
Table_Survey<-TripDaten_test %>%
  dplyr::select(TRIP_ID,DATE,STARTTIME,ENDTIME,STRIP_WIDTH)%>%
  mutate(Condition=case_when(STRIP_WIDTH >= 400 ~ "Reached the minimum 400 m",
                             TRUE ~ "Didnt reach the minimum 400 m"))
```

```{r StripWidthKnitr,  echo=FALSE, eval=TRUE}
knitr::kable(Table_Survey)
```


### Area observed

What was the proportion of **area analysed** in relation to the **area observed**?
A minimum proportion of 70% of the recorded images or videos must be analyzable. Otherwise surveys must be repeated (at company's expenses). 

```{r TableAreas,echo=FALSE}
Table_Areas <- data.frame(survey_dates = as.character(Table_Survey$DATE),
                         area_observed = TripDaten_test$AREA_OBSERVED,
                         area_analysed= TripDaten_test$AREA_ANALYSED,
                         area_proportion = round(((TripDaten_test$AREA_ANALYSED*100)/TripDaten_test$AREA_OBSERVED),2)
)
Table_Areas<-Table_Areas %>%
    mutate(Condition=case_when(area_proportion > 70 ~ "Reached the minimum 70%",
                             TRUE ~ "Did not reach the minimum 70%"))
```

```{r TableAreasKnitr,  echo=FALSE, eval=TRUE}
names(Table_Areas) <- c("survey dates (YYYYMMDD)","area observed [km^2]","area analysed [km^2]","Proportion [%]","Condition")
knitr::kable(Table_Areas)
```

### Area controlled

What was the **area analysed** and the **area controlled** (i.e. area controlled during the screening control) in relation to the area analysed?

Area controlled should be > 20%. 

```{r TableControlled, echo=FALSE, include=TRUE}
#Define parameters
AreaAnalysed<-as.numeric(TripDaten_test$AREA_ANALYSED)
AreaControlled<-as.numeric(TripDaten_test$AREA_CONTROLLED)
FlightDate<-as.character(TripDaten_test$DATE)
AreaControlled_percent<-(AreaControlled/AreaAnalysed)*100
```

```{r TableControlledCondition, echo=FALSE, eval=TRUE}
Table_Controlled <- data.frame(survey_dates = as.character(Table_Survey$DATE),
                          area_analysed = AreaAnalysed,
                          area_controlled= AreaControlled,
                          area_controlled_prop =  round(AreaControlled_percent,2))
Table_Controlled<-Table_Controlled %>%
    mutate(Condition=case_when(area_controlled_prop > 20 ~ "Reached the minimum 20%",
                             TRUE ~ "Didnt reach the minimum 20%"))
```

```{r TableControlledNames, echo=FALSE, eval=TRUE}
names(Table_Controlled) <- c("survey dates (YYYYMMDD)","area analysed [km^2]","area controlled [km^2]","area controlled [%]","Condition")
```

```{r TableControlledKnitr,  echo=FALSE, eval=TRUE}
knitr::kable(Table_Controlled)
```

# Save

```{r}
save(TripDaten_test, file = "TripDaten_test.RData", version = 2)
```

# ~~~~~~~~~~~~~~~~~~~~~~
# Basisdaten

Transect Latitude

```{r}
LAT_PIC_CENTER<-BasisDaten_original$LAT_PIC_CENTER[1:74400]
```

Transect Longitude

```{r}
LON_PIC_CENTER<-BasisDaten_original$LON_PIC_CENTER[1:74400]
```

Plane Height Variation

```{r}
PLANE_HEIGHT <- Basis_plane$PLANE_FLIGHT_HEIGHT[1:10000]
PLANE_HEIGHT_VARIATION<-c(PLANE_HEIGHT,PLANE_HEIGHT,PLANE_HEIGHT,PLANE_HEIGHT,PLANE_HEIGHT,PLANE_HEIGHT,PLANE_HEIGHT,PLANE_HEIGHT)[1:74400]
```

Position controlled

Enter if an image has been controlled during the screening control = 1, ID control = 2, or during both working steps = 3.

```{r}
#BasisDaten_original %>% group_by(POSITION_ID_CONTROLLED) %>% tally() %>% mutate(total=sum(n))%>% mutate(prop=n*100/total)
POSITION_ID_CONTROLLED<-rep(1, time=74400) 
POSITION_ID_CONTROLLED[floor(runif(14850, min=0, max=1000))]<-NA #~80%
POSITION_ID_CONTROLLED[floor(runif(220, min=0, max=1000))]<-2 
POSITION_ID_CONTROLLED[floor(runif(60, min=0, max=1000))]<-3 
```

Time

```{r}
TIME <- seq(
  from = as.POSIXct("09:00:01", format = "%H:%M:%S", tz = "UTC"),
  to = as.POSIXct("10:00:00", format = "%H:%M:%S", tz = "UTC"),
  by = '1 sec')
TIME_PER_CAMERA <-c(TIME,TIME,TIME,TIME,TIME,TIME,TIME,TIME)
TIME_SORTED <- sort(TIME_PER_CAMERA)
TIME_CHARACTER <- format(TIME_SORTED, "%H:%M:%S")[1:74400]
```

Glare

```{r}
GLARE<-rep(0, time=74400) 
GLARE[floor(runif(14850, min=0, max=10000))]<-1 
GLARE[floor(runif(12000, min=0, max=70000))]<-2 
GLARE[10000:15000]<-3
```

Seastate

```{r}
SEASTATE<-rep(1, time=74400) 
SEASTATE[10000:15000]<-2
SEASTATE[15000:30000]<-3 
SEASTATE[30000:40000]<-4 
SEASTATE[60000:74000]<-0
```

Turbidity

```{r}
TURBIDITY<-rep(1, time=74400) 
TURBIDITY[10000:15000]<-2
TURBIDITY[30000:40000]<-3 
```

Clarity

```{r}
CLARITY<-rep(1, time=74400) 
CLARITY[10000:30000]<-2
CLARITY[60000:70000]<-3 
```


Picture quality

```{r}
#BasisDaten_original %>% group_by(PIC_QUALITY) %>% tally() %>% mutate(total=sum(n))%>% mutate(prop=n*100/total)
PIC_QUALITY<-rep(1, time=74400) 
PIC_QUALITY[floor(runif(15200, min=10000, max=20000))]<-2 #7%
```

```{r}
BasisDaten_test<-data.frame(
  POSITIONS=NA,
  POSITION_ID=seq(1:74400),
  POSITION_ID_CONTROLLED=POSITION_ID_CONTROLLED,
  Dataset_ID=NA,
  TRIP_ID=1,
  CRUISENO='AreaA_Summer_2025',
  CAMERA_NUMBER=c(1, 2, 3, 4, 5, 6, 7, 8),
  TRANSECT_NUMBER=rep(1:8, each=(74400/8)),
  DATE='20250616',
  TIME=TIME_CHARACTER,
  LAT_PIC_CENTER=LAT_PIC_CENTER,
  LON_PIC_CENTER=LON_PIC_CENTER,
  PLANE_FLIGHT_HEIGHT=PLANE_HEIGHT_VARIATION,
  PIC_AREA_ANALYSED=round(runif(74400,0,0.05),2),
  GLARE=GLARE,
  SEASTATE=SEASTATE,
  TURBIDITY=TURBIDITY,
  ICE=0,
  CLARITY=CLARITY,
  PIC_QUALITY=PIC_QUALITY,
  PIC_FILE_NAME=NA,
  NOTES=NA
  )
```

```{r}
BasisDaten_test<-BasisDaten_test %>%
  mutate(PIC_FILE_NAME=paste0("CAM",
                              CAMERA_NUMBER,"-",
                              rep(1:4, times=250),
                              rep(c("L","L","L","L","R","R","R","R"),times=125)))
```


# Quality Checks

## Survey Map

```{r}
library(sf)
```

```{r}
SummerDots<-fortify(BasisDaten_test)
SummerDots$lat<-as.numeric(SummerDots$LAT_PIC_CENTER)
SummerDots$lon<-as.numeric(SummerDots$LON_PIC_CENTER)
SummerDots <- SummerDots[!is.na(SummerDots$lat), ] 
SummerDotsC <- st_as_sf(SummerDots, coords = c("lon", "lat"),crs = 4326, agr = "constant")
```

```{r BaseMapImportShapefiles, echo=FALSE, include=FALSE, eval=TRUE}
Study_areas<-st_transform(GermanNorthSea::Study_areas,4326)
Protected_SCA<- st_transform(GermanNorthSea::German_SCA,4326)
Land<- st_transform(GermanNorthSea::German_land,4326)
Protected_natura <- st_transform(GermanNorthSea::German_natura,4326)
```

```{r}
ggplot(data = SummerDots) +
  geom_sf(data = Study_areas, aes(fill=stratum),colour = 'black', alpha=0.1)+
  scale_fill_manual(values = c(A = '#7400b8',B = '#6930c3',C = '#5e60ce',D = '#277da1',E = '#577590',F = '#4d908e',
                               G = '#43aa8b',H = '#90be6d',I = '#f9c74f',J = '#ff6d00',K = '#f8961e',L = '#f3722c',
                               N = '#f94144'))+
  geom_point(data = SummerDots, 
                aes(x = lon, y = lat), 
                size = 1, shape = 21, colour = "#9d0208")+
  geom_sf(data = Land, colour = 'black', fill = '#e5e5e5')+
  coord_sf(xlim = c(3, 15), ylim = c(53, 56), expand = FALSE)+
  theme_bw()+
  xlab('Longitude')+ylab('Latitude')+
  theme(axis.text = element_text(size=20),
        axis.title.x = element_text(size=20),
        axis.title.y = element_text(size=20),
        legend.position='none')+
  scale_x_continuous(labels = function(x) paste0(x, '\u00B0', "W")) +
  scale_y_continuous(labels = function(x) paste0(x, '\u00B0', "N")) 
```

## Plane height
Some variation in plane height during the survey is expected. 

```{r FlightHeightPlot, echo=F, fig.width=10, fig.height=4.5, warning=FALSE}
ggplot(data=BasisDaten_test,aes(x=POSITION_ID,y=PLANE_FLIGHT_HEIGHT),color=CAMERA_NUMBER)+
    geom_point(aes(colour = factor(PLANE_FLIGHT_HEIGHT)), size = 1,color='darkblue') +
    xlab("Picture_ID")+ylab('Plane height')+
  theme_classic()+ 
  theme(axis.title = element_text(size=15),
        axis.ticks.x = element_blank(),
        axis.text.y = element_text(size=15),
        legend.position='none')+
  scale_x_discrete(limits=BasisDaten_test$POSITION_ID,
                   breaks=BasisDaten_test$POSITION_ID[seq(1,length(BasisDaten_test$POSITION_ID),by=5000)])+
  theme(axis.text.x = element_text(angle=90,size=8))
```

## Picture quality

```{r TablePicture, echo=FALSE,eval=TRUE, include=FALSE}
FlightName<-unique(BasisDaten_test$CRUISENO)
GoodQuality<-BasisDaten_test%>%
  filter(PIC_QUALITY==1)%>%
  tally()
BadQuality<-BasisDaten_test%>%
  filter(PIC_QUALITY==2)%>%
  tally()
```

```{r TablePictureNames, echo=FALSE,eval=TRUE}
Table_Picture<- data.frame(survey = FlightName,
                              good_quality = GoodQuality$n,
                              bad_quality = BadQuality$n)
Table_Picture<-Table_Picture %>%
  mutate(pic_quality_percent = (good_quality*100)/(good_quality+bad_quality))

names(Table_Picture) <- c("survey",
                             "Good quality pictures (n)",
                             "Bad quality pictures (n)",
                             "Percentage good quality [%]")
  
```

What is the proportion of pictures that had **good quality**.  
Is expected to be above 80%. 

```{r TablePictureKnitr, echo=FALSE, eval=TRUE}
knitr::kable(Table_Picture)
```


Picture quality classification corresponds to: 1= the image has been analysed, 2= image quality too bad for analysis (in red).

```{r WeatherPlotFunction, echo=F, eval=T}
PlotConditions<-function(EjeY=EjeY){
  
  BasisDaten_test$EjeX<-BasisDaten_test$POSITION_ID
  BasisDaten_test$SEASTATE<-as.numeric(BasisDaten_test$SEASTATE)

  ggplot(data=BasisDaten_test,aes(x=EjeX,y=EjeY),color=CAMERA_NUMBER)+
    geom_point(aes(colour = factor(EjeY)), size = 1) +
    xlab("Picture_ID")+
  theme_classic()+ 
  theme(axis.title = element_text(size=15),
        axis.ticks.x = element_blank(),
        axis.text.y = element_text(size=15),
        legend.position='none')+
  scale_x_discrete(limits=BasisDaten_test$EjeX,breaks=BasisDaten_test$EjeX[seq(1,length(BasisDaten_test$EjeX),by=5000)])+
  theme(axis.text.x = element_text(angle=90,size=8))
}
```

```{r PicturePlot, echo=F, fig.width=10, fig.height=3, warning=FALSE}
BasisDaten_test$PIC_QUALITY<-as.numeric(BasisDaten_test$PIC_QUALITY)
PlotConditions(EjeY=BasisDaten_test$PIC_QUALITY)+
  ylab("Picture quality")+
  scale_y_continuous(limits=c(0,3),breaks=c(0,1,2,3))+ 
  scale_color_manual(breaks = c("1", "2"),
                     values=c("0"="#457b9d",
                              "1"="#457b9d", #blue
                              "2"="#e63946")) #red
```

## Glare
Intensity of the reflection of the sun in regular intervals and after a change of direction or transect, ascertained for the analysed part of the image. Defined as 0 = No glare, 1 = low glare, 2 = medium glare, 3 = strong glare.

```{r GlarePlot, echo=F, fig.width=10, fig.height=3, warning=FALSE}
BasisDaten_test$GLARE<-as.numeric(BasisDaten_test$GLARE)
PlotConditions(EjeY=BasisDaten_test$GLARE)+
  ylab("Glare")+
  scale_y_continuous(limits=c(-0.5,3))+ 
  scale_color_manual(values=c("0"="#457b9d",
                              "1"="#457b9d",
                              "2"="#457b9d",
                              "3"="#e63946", #red
                              "1.5"="#fb8500",#dummis in yellow
                              "2.5"="#fb8500"))
```

## Sea state
Sea state classification goes from 0 to 7.  Values <3 in blue, values > 3 in red. Usually no flights are performed above 3. 

```{r SeastatePlot, echo=F, fig.width=10, fig.height=4.5, warning=FALSE}
PlotConditions(EjeY=as.numeric(BasisDaten_test$SEASTATE))+
  ylab("Sea state")+
  scale_y_continuous(expand = c(0,0),limits=c(-0.5,7.5), breaks=c(0,1,2,3,4,5,6,7))+
  scale_color_manual(values=c("0"="#457b9d", #0
                              "1"="#457b9d", #1
                              "2"="#457b9d", #2 
                              "3"="#457b9d", #3 blue
                              "4"="#e63946", #4 red
                              "5"="#e63946", #5
                              "6"="#e63946", #6
                              "7"="#e63946"))#7
```

## Turbidity
Turbidity goes from 1-3. Classification corresponds to: 1= no turbidity, 2= medium turbidity, 3=strong turbidity. Note: 0 is not allowed and is shown is marked in red. 

```{r TurbidityPlot, echo=F, fig.width=10, fig.height=4.5, warning=FALSE}
BasisDaten_test$TURBIDITY<-as.numeric(BasisDaten_test$TURBIDITY)
PlotConditions(EjeY=BasisDaten_test$TURBIDITY)+
  ylab("Turbidity")+
  scale_y_continuous(limits=c(-0.5,3.5),breaks=c(0,1,2,3)) +
  scale_color_manual(values=c("0"="#e63946", #red
                              "1"="#457b9d", #blue
                              "2"="#457b9d",
                              "3"="#457b9d"))
```

## Clarity
Clarity of the air goes from: 0 = not recorded, 1 = little, 2 = medium, 3 = strong. 

```{r ClarityPlot, echo=F, fig.width=10, fig.height=3, warning=FALSE}
BasisDaten_test$CLARITY<-as.numeric(BasisDaten_test$CLARITY)
PlotConditions(EjeY=BasisDaten_test$CLARITY)+
  ylab("Clarity of air")+
  scale_y_continuous(limits=c(0,3))+
  scale_color_manual(values=c("0"="#e63946", #red
                              "1"="#457b9d", #blue
                              "2"="#457b9d",
                              "3"="#457b9d"))
```

# Save

```{r}
save(BasisDaten_test, file = "BasisDaten_test.RData", version = 2)
```

# ~~~~~~~~~~~~~~~~~~~~~~

# Observations

```{r}
library(tidyverse)
```

### Column names

```{r}
COLUMN_NAMES<-data.frame(OBSERVATIONS=NA,  
                         OBSERVATION_ID=NA,
                         POSITION_ID=NA, 
                         Dataset_ID=NA,
                         CRUISENO='AreaA_Summer_2025', 
                         ABIOTIC_STRUCTURES=NA, 
                         ABIOTIC_OBSERVATION =NA, 
                         OBSERVATION=as.character(0), 
                         ENGLISH_NAME_BEFORE_CONTROL=NA, 
                         ENGLISH_NAME_CONTROL_ID =NA,
                         ID_MATCH_MISMATCH=NA, 
                         ENGLISH_NAME=NA, 
                         DETECTION_STEP =NA, 
                         BEHAVIOUR=NA,
                         ACTIVITY=NA, 
                         GROUP_ =NA, 
                         FAMILY_GROUP=NA, 
                         ASSOCIATIONS=NA, 
                         HEADING =NA, 
                         SUBMERGED=NA, 
                         AGE_CLASS=NA, 
                         AGE_YEARS=NA, 
                         PLUMAGE=NA, 
                         SEX=NA,
                         LENGTH =NA, 
                         WING_SPAN=NA, 
                         FLIGHT_HEIGHT=NA, 
                         FLIGHT_HEIGHT_CONFIDENCE=NA, 
                         FLIGHT_HEIGHT_METHOD_ID=NA,
                         LAT_OBJECT=NA, 
                         LON_OBJECT=NA,
                         NOTES=NA  
)
```

## Abiotic structures

```{r}
ABIOTIC_STRUCTURES<-data.frame(ABIOTIC_STRUCTURES=c(1000,1001,1002,2001,2002,3000,
                                                    3101,3102,4100,4200,4205,4310,
                                                    4311,4313,4400,7206,7207,7208,
                                                    7209,7212,7300,7301,8000))
```

```{r}
ABIOTIC_OBSERVATIONS<-data.frame(ABIOTIC_OBSERVATION=c(5103,5202,5300,7103,8000))
```

## Observation

English name before control
keep some, mix others

```{r}
EURINGS<-seamonas::Code_Euring %>% select(Code,English_name)%>%rename(OBSERVATION=Code,ENGLISH_NAME=English_name)
```

```{r}
OBSERVATION1<-data.frame(OBSERVATION=unique(Species_list$SPECIES_CODE))
OBSERVATION2<-OBSERVATION1 %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')
OBSERVATION3<-OBSERVATION2%>%
  mutate(ENGLISH_NAME_BEFORE_CONTROL=ENGLISH_NAME,
         ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME,
         ID_MATCH_MISMATCH=1)
```

```{r}
#duplicate 50% of those rows
OBSERVATION4<-OBSERVATION3 %>% sample_frac(.75)
OBSERVATION5<-OBSERVATION4 %>% sample_frac(.75)
OBSERVATION6<-OBSERVATION5 %>% sample_frac(.75)
OBSERVATION7<-OBSERVATION6 %>% sample_frac(.75)
OBSERVATION8<-OBSERVATION7 %>% sample_frac(.75)
OBSERVATION9<-OBSERVATION8 %>% sample_frac(.75)
```

```{r}
OBSERVATION10<-rbind(OBSERVATION3,
                     OBSERVATION4,OBSERVATION4,OBSERVATION4,
                     OBSERVATION5,OBSERVATION5,OBSERVATION5,
                     OBSERVATION6,OBSERVATION6,OBSERVATION6,
                     OBSERVATION7,OBSERVATION7,OBSERVATION7,
                     OBSERVATION8,OBSERVATION8,OBSERVATION8,
                     OBSERVATION9,OBSERVATION9,OBSERVATION9)
```

```{r}
OBSERVATION10%>%
  group_by(ENGLISH_NAME)%>%
  tally()
```

## English name before control

```{r}
ENGLISH_NAME_BEFORE_CONTROL0<-Species_errors %>%
  filter(TOTAL_OBSERVATIONS>5)%>%
  drop_na(ENGLISH_NAME_CONTROL_ID) %>%
  mutate(ID_MATCH_MISMATCH = if_all(ENGLISH_NAME_BEFORE_CONTROL, `==`, ENGLISH_NAME_CONTROL_ID))%>%
  mutate(ID_MATCH_MISMATCH=case_when(ID_MATCH_MISMATCH==FALSE~'2',
                                     ID_MATCH_MISMATCH==TRUE~'1'))%>%
  filter(ID_MATCH_MISMATCH==2)
```

```{r}
ENGLISH_NAME_BEFORE_CONTROL1<-data.frame(
  OBSERVATION=as.character(ENGLISH_NAME_BEFORE_CONTROL0$SPECIES_CODE),
  ENGLISH_NAME_BEFORE_CONTROL=ENGLISH_NAME_BEFORE_CONTROL0$ENGLISH_NAME_BEFORE_CONTROL,
  ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME_BEFORE_CONTROL0$ENGLISH_NAME_CONTROL_ID,
                                         ID_MATCH_MISMATCH=2)
ENGLISH_NAME_BEFORE_CONTROL1
```

```{r}
length(unique(ENGLISH_NAME_BEFORE_CONTROL1$OBSERVATION))
```

```{r}
#duplicate 25% of those rows
ENGLISH_NAME_BEFORE_CONTROL2<-ENGLISH_NAME_BEFORE_CONTROL1 %>% sample_frac(.25)
ENGLISH_NAME_BEFORE_CONTROL3<-ENGLISH_NAME_BEFORE_CONTROL2 %>% sample_frac(.25)
ENGLISH_NAME_BEFORE_CONTROL4<-ENGLISH_NAME_BEFORE_CONTROL3 %>% sample_frac(.25)
ENGLISH_NAME_BEFORE_CONTROL5<-ENGLISH_NAME_BEFORE_CONTROL4 %>% sample_frac(.25)
```

```{r}
ENGLISH_NAME_BEFORE_CONTROL10<-rbind(ENGLISH_NAME_BEFORE_CONTROL1,
                       ENGLISH_NAME_BEFORE_CONTROL2,
                       ENGLISH_NAME_BEFORE_CONTROL3,
                       ENGLISH_NAME_BEFORE_CONTROL4,
                       ENGLISH_NAME_BEFORE_CONTROL5)
```

```{r}
ENGLISH_NAME_BEFORE_CONTROL10 %>%
  group_by(ENGLISH_NAME_CONTROL_ID)%>%
  tally()
```

```{r}
ENGLISH_NAME_BEFORE_CONTROL10<-ENGLISH_NAME_BEFORE_CONTROL10 %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')
```

## Behaviour

```{r}
seamonas::Code_Descriptions %>%
  select(starts_with('BEHAV'))%>%
  drop_na()
```

```{r}
BEHAVIOURS<-data.frame(OBSERVATION=as.character(c(Behaviour_codes$SPECIES_CODE)),
                       BEHAVIOUR=c(Behaviour_codes$BEHAVIOUR_CODE))
```

```{r}
BEHAVIOURS<-BEHAVIOURS %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')%>%
  mutate(ENGLISH_NAME_BEFORE_CONTROL=ENGLISH_NAME,
         ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME,
         ID_MATCH_MISMATCH=1)%>%
  relocate(OBSERVATION,ENGLISH_NAME_BEFORE_CONTROL,ENGLISH_NAME_CONTROL_ID,ID_MATCH_MISMATCH,ENGLISH_NAME,
           BEHAVIOUR)
```


## Activity

```{r}
seamonas::Code_Descriptions %>%
  select(ACTIVITY_CODE,ACTIVITY_DESCRIPTION)%>%
  drop_na()
```

```{r}
ACTIVITIES<-data.frame(OBSERVATION=as.character(c(63510,63510,63510,
                                       63510,63510,63510,
                                       5920,	6004,	6005,	
                                       6005,	6005,	6005,	
                                       6005, 5920, 5920,
                                       5920,5920)),
                        ENGLISH_NAME_BEFORE_CONTROL=c('Harbour Porpoise',
                                       'Harbour Porpoise',
                                       'Harbour Porpoise',
                                       'Harbour Porpoise',
                                       'Harbour Porpoise',
                                       'Harbour Porpoise',
                                       'Herring Gull',
                                       'Common Gull/Herring Gull',
                                       'unidentified large gull',
                                       'unidentified large gull',
                                       'unidentified large gull',
                                       'unidentified large gull',
                                       'unidentified large gull',
                                       'Herring Gull',
                                       'Herring Gull',
                                       'Herring Gull',
                                       'Herring Gull'),
                        ACTIVITY=c(3,3,3,
                                   4,4,4,
                                   5,5,5,
                                   5,5,5,
                                   5,1,1,
                                   2,2))
```

```{r}
ACTIVITIES<-ACTIVITIES %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')%>%
  mutate(ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME,
         ID_MATCH_MISMATCH=1)%>%
  relocate(OBSERVATION,ENGLISH_NAME_BEFORE_CONTROL,ENGLISH_NAME_CONTROL_ID,ID_MATCH_MISMATCH,ENGLISH_NAME,
           ACTIVITY)
```

## Group and family group

```{r}
FAMILY_GROUPS<-data.frame(OBSERVATION=as.character(c(6340,6340,63510,63510,63510,63510,63510,63510)),
                         ENGLISH_NAME_BEFORE_CONTROL=c("Common Guillemot","Common Guillemot",
                                                        "Harbour Porpoise","Harbour Porpoise",
                                                        "Harbour Porpoise","Harbour Porpoise",
                                                        "Harbour Porpoise","Harbour Porpoise"),
                         ID_MATCH_MISMATCH=c(1,1,1,1,1,1,1,1),
                         ACTIVITY=c(1,1,4,1,1,4,1,1), 
                         GROUP_ = c(1,1,2,2,3,3,4,4), 
                         FAMILY_GROUP=c(1,1,2,2,3,3,4,4), 
                         AGE_CLASS=c('A','IM','A','IM','A','IM','A','IM'))
```

```{r}
FAMILY_GROUPS<-FAMILY_GROUPS %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')%>%
  mutate(ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME,
         ID_MATCH_MISMATCH=1)%>%
  relocate(OBSERVATION,ENGLISH_NAME_BEFORE_CONTROL,ENGLISH_NAME_CONTROL_ID,ID_MATCH_MISMATCH,ENGLISH_NAME,
           ACTIVITY,GROUP_,FAMILY_GROUP,AGE_CLASS)
```


## Association

```{r}
seamonas::Code_Descriptions %>%
  select(starts_with('ASSOCIATION'))%>%
  drop_na()
```

```{r}
ASSOCIATIONS<-data.frame(OBSERVATION=as.character(Association_codes$SPECIES_CODE), 
                         ASSOCIATIONS=c(Association_codes$ASSOCIATION_CODE))
```

```{r}
ASSOCIATIONS<-ASSOCIATIONS %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')%>%
  mutate(ENGLISH_NAME_BEFORE_CONTROL=ENGLISH_NAME,
         ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME,
         ID_MATCH_MISMATCH=1)%>%
  relocate(OBSERVATION,ENGLISH_NAME_BEFORE_CONTROL,ENGLISH_NAME_CONTROL_ID,ID_MATCH_MISMATCH,ENGLISH_NAME,
           ASSOCIATIONS)
```

## Submerged

```{r}
seamonas::Code_Descriptions %>%
  select(ACTIVITY_CODE,ACTIVITY_DESCRIPTION)%>%
  drop_na()
```

```{r}
SUBMERGEDS<-data.frame(OBSERVATION=as.character(c(61010,63510,64310, #o
                                            63510,64310, #u
                                            60000,60010,63510,64310,64320,64330 #x
                                            )),
                      ENGLISH_NAME_BEFORE_CONTROL=c("unidentified whale",
                                         "Harbour Porpoise",
                                         "unidentified pinniped (Grey Seal/Harbour Seal)",
                                         "Harbour Porpoise",
                                         "unidentified pinniped (Grey Seal/Harbour Seal)",
                                         "unidentified marine mammal",
                                         "seal/small cetacean",
                                         "Harbour Porpoise",
                                         "unidentified pinniped (Grey Seal/Harbour Seal)",
                                         "Grey Seal",
                                         "Harbour Seal"),
                      SUBMERGED=c("o","o","o", # breaching
                                   "u","u", # below surface
                                   "x","x","x","x","x","x"),# not clearly recognizable
                      AGE_CLASS=rep("A",each=11),
                      ACTIVITY=c(3,3,3,
                                 1,1,1,
                                 4,4,4,
                                 3,3)
)
```

```{r}
SUBMERGEDS<-SUBMERGEDS %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')%>%
  mutate(ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME,
         ID_MATCH_MISMATCH=1)%>%
  relocate(OBSERVATION,ENGLISH_NAME_BEFORE_CONTROL,ENGLISH_NAME_CONTROL_ID,ID_MATCH_MISMATCH,ENGLISH_NAME,
           ACTIVITY,SUBMERGED,AGE_CLASS)
```

## Age_year

```{r}
AGE_CLASSES<-data.frame(OBSERVATION=as.character(c(5820,5900,5909,5910,6005,6340,63510,6360,710, #1
                                            5900,5910,5920,6000,6020,710, #2
                                            5900,5910,5920,6000,710, #3
                                            5910,5920,6000,710, #4
                                            710 #5
                                            )),
                      ACTIVITY=rep(2,each=25),
                      AGE_CLASS=rep("IM",each=25),
                      AGE_YEARS=c(1,1,1,1,1,1,1,1,1, #1
                                  2,2,2,2,2,2, #2
                                  3,3,3,3,3, #3
                                  4,4,4,4, #4
                                  5 #5 
                                  ))
```

```{r}
AGE_CLASSES<-AGE_CLASSES %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')%>%
  mutate(ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME,
         ENGLISH_NAME_BEFORE_CONTROL=ENGLISH_NAME,
         ID_MATCH_MISMATCH=1)%>%
  relocate(OBSERVATION,ENGLISH_NAME_BEFORE_CONTROL,ENGLISH_NAME_CONTROL_ID,ID_MATCH_MISMATCH,ENGLISH_NAME,
           ACTIVITY,AGE_CLASS,AGE_YEARS)
```

## Plumage

```{r}
PLUMAGES<-data.frame(OBSERVATION=as.character(c(5670)), 
                     ENGLISH_NAME_BEFORE_CONTROL=c('Arctic Skua'),
                     ENGLISH_NAME_CONTROL_ID=c('Arctic Skua'), 
                     ID_MATCH_MISMATCH=1, 
                     ENGLISH_NAME=c('Arctic Skua'),
                     ACTIVITY=2, 
                     PLUMAGE="D")
```

## Sex

```{r}
SEXS<-data.frame(OBSERVATION=as.character(c(20,1790,1840,1860,1890,1940,2030,
                                   2040,2060,2120,2130,2150,2180,2210,
                                   2230,20,1790,1840,1860,1890,1940,
                                   2030,2040,2060,2120,2130,2150,
                                   2180,2210,2230)),
                 ACTIVITY = 2,
                 SEX=c("F","F","F","F","F","F","F","F","F","F","F","F","F","F","F",
                       "M","M","M","M","M","M","M","M","M","M","M","M","M","M","M"))
```

```{r}
SEXS<-SEXS %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')%>%
  mutate(ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME,
         ENGLISH_NAME_BEFORE_CONTROL=ENGLISH_NAME,
         ID_MATCH_MISMATCH=1)%>%
  relocate(OBSERVATION,ENGLISH_NAME_BEFORE_CONTROL,ENGLISH_NAME_CONTROL_ID,ID_MATCH_MISMATCH,ENGLISH_NAME,
           ACTIVITY,SEX)
```


## Lenght

```{r}
LENGHTS<-data.frame(OBSERVATION=as.character(c(5910,5910,
                                               6020,6020,
                                               6340,6340,
                                               63510,63510,
                                               64310,64310,
                                               710,710)), 
                              ACTIVITY = 1, 
                              LENGTH =c (34.6,53.4,
                                         26.6,57.3, 
                                         20.8,45.2,
                                         98.6,160.5,
                                         55.1,189.7,
                                         46.0,104.7))
```

```{r}
LENGHTS %>%
  group_by(OBSERVATION)%>%
  summarise(min_LENGTH=min(LENGTH),
            max_LENGTH=max(LENGTH))
```

```{r}
LENGHTS<-LENGHTS %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')%>%
  mutate(ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME,
         ENGLISH_NAME_BEFORE_CONTROL=ENGLISH_NAME,
         ID_MATCH_MISMATCH=1)%>%
  relocate(OBSERVATION,ENGLISH_NAME_BEFORE_CONTROL,ENGLISH_NAME_CONTROL_ID,ID_MATCH_MISMATCH,ENGLISH_NAME,
           ACTIVITY,LENGTH)
```

## Wing span

```{r}
WINGS<-data.frame(OBSERVATION=as.character(c(5910,710,6020,63510,6340,
                                             64310,6000,6159,5920,6360,
                                             5909,5820,0,220,6110,5910,
                                             710,6020,63510,6340,64310,
                                             6000,6159,5920,6360,5909,
                                             5820,0,220,6110)), 
                  ACTIVITY = 1,  
                  WING_SPAN=c(0,0,0,0,0,0,141.5,57.5,0,0,102.6,75.6,0,102.7,83.3,
                              162.8,202.5,135.3,0,76.1,0,143.4,101.8,149.6,0,102.6,115.1,0,102.7,83.3))
```

```{r}
WINGS %>%
  group_by(OBSERVATION)%>%
  summarise(min_WING_SPAN=min(WING_SPAN),
            max_WING_SPAN=max(WING_SPAN))
```

```{r}
# Remove those that were filled with 0 and that correspond to marine mammals
WINGS<-WINGS %>%
  filter(!OBSERVATION %in% c(63510,	64310,0),
         WING_SPAN != 0) #remove zeros
```

```{r}
WINGS<-WINGS %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')%>%
  mutate(ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME,
         ENGLISH_NAME_BEFORE_CONTROL=ENGLISH_NAME,
         ID_MATCH_MISMATCH=1)%>%
  relocate(OBSERVATION,ENGLISH_NAME_BEFORE_CONTROL,ENGLISH_NAME_CONTROL_ID,ID_MATCH_MISMATCH,ENGLISH_NAME,
           ACTIVITY,WING_SPAN)
```

## Height

```{r}
HEIGHTS<-data.frame(OBSERVATION=as.character(c(5910,710,6020,63510,6340,64310,6000,6159,5900,2130,5920,
                                  5820,59,6360,5780,6005,6008,5909,6049,1580,6345,720,1220,
                                  220,6110,20,4850,6318,5659,19998,5410,6319,5340,7950,3009,
                                  3040,6259,4500,6009,6048,15600,5670,6160,1610,19999,5709,
                                  1680,2060,2150,1670,2269,2120,2690,2600,30,2210,1790,15630,
                                  1890,6680,1860,1820,1730,110,2230,5910,710,6020,63510,6340,
                                  64310,6000,6159,5900,2130,5920,5820,59,6360,5780,6005,6008,
                                  5909,6049,1580,6345,720,1220,220,6110,20,4850,6318,5659,19998,
                                  5410,6319,5340,7950,3009,3040,6259,4500,6009,6048,15600,
                                  5670,6160,1610,19999,5709,1680,2060,2150,1670,2269,2120,2690,
                                  2600,30,2210,1790,15630,1890,6680,1860,1820,1730,110,2230)), 
                    ACTIVITY = 1,
                    FLIGHT_HEIGHT=c(0,0,0,0,0,0,0.2,0,0,0,0,0,0.3,0,0,1,1,0,0,15,0,0.1,216,
                                0,0,0.2,0,0,0,0,0,0,44,121,72,49,0,66,24,68,102,5,5,6,
                                131,6,21,29,0.2,4,8,0,185,20,0.2,0.4,9,3,9,113,15,180,0.4,2,8,
                                # Max
                                349,186,188,0,98,0,267,396,443,195,306,349,46,0,170,192,
                                208,182,193,36,71,192,216,77,411,531,201,163,181,228,371,
                                410,92,121,72,138,55,66,61,68,102,26,41,18,202,6,32,79,216,
                                30,185,156,185,20,4,119,191,44,80,125,38,180,0.4,2,8), 
                    FLIGHT_HEIGHT_CONFIDENCE=c("0 - 0",
                                               "-1 - 17",
                                               "-1 - 13",
                                               "0",
                                               "-10 - 32",
                                               "0",
                                               "-17 - 38",
                                               "-1 - 102",
                                               "-1 - 13",
                                               "-1 - 10",
                                               "-10 - 10",
                                               "-10 - 24",
                                               "-14 - 75",
                                               "0",
                                               "-1 - 15",
                                               "-1 - 15",
                                               "-11 - 13",
                                               "-12 - 72",
                                               "-10 - 46",
                                               "-11 - 34",
                                               "-2 - 28",
                                               "-1 - 8",
                                               "212 - 220",
                                               "-1 - 18",
                                               "-1 - 12",
                                               "-1 - 30",
                                               "-18 - 74",
                                               "-1 - 24",
                                               "-1 - 21",
                                               "-14 - 36",
                                               "-4 - 8",
                                               "-11 - 17",
                                               "25 - 68",
                                               "92 - 150",
                                               "60 - 81",
                                               "137 - 140",
                                               "0 - 0",
                                               "61 - 70",
                                               "11 - 38",
                                               "63 - 73",
                                               "85 - 112",
                                               "-7 - 17",
                                               "-4 - 22",
                                               "-18 - 47",
                                               "119 - 142",
                                               "-13 - 23",
                                               "11 - 49",
                                               "20 - 39",
                                               "-1 - 48",
                                               "-14 - 36",
                                               "-3 - 18",
                                               "-1 - 16",
                                               "182 - 188",
                                               "14 - 30",
                                               "-11 - 13",
                                               "-12 - 50",
                                               "-8 - 24",
                                               "-18 - 29",
                                               "14","113",
                                               "-2 - 33",
                                               "176 - 187",
                                               "Height By Reflection",
                                               "-3 - 7",
                                               "-29 - 32",
                                               "Medium",
                                               "Medium",
                                               "Medium",
                                               "0",
                                               "Medium",
                                               "0",
                                               "Medium",
                                               "Medium",
                                               "Height By Reflection",
                                               "Height By Reflection",
                                               "Medium",
                                               "Medium",
                                               "Height By Reflection",
                                               "0",
                                               "84 - 110",
                                               "97 - 116",
                                               "90 - 132",
                                               "89 - 101",
                                               "95 - 109",
                                               "9 - 36",
                                               "6 - 55",
                                               "Height By Reflection",
                                               "212 - 220",
                                               "Medium",
                                               "Medium",
                                               "Height By Reflection",
                                               "73 - 77",
                                               "95 - 144",
                                               "9 - 41",
                                               "93 - 96",
                                               "97 - 119",
                                               "96 - 183",
                                               "77 - 106",
                                               "92 - 150",
                                               "60 - 81",
                                               "45 - 51",
                                               "44 - 65",
                                               "61 - 70",
                                               "58 - 65",
                                               "63 - 73",
                                               "85 - 112",
                                               "23 - 30",
                                               "26 - 50",
                                               "11 - 26",
                                               "200 - 204",
                                               "-13 - 23",
                                               "21 - 29",
                                               "73 - 76",
                                               "Height By Reflection",
                                               "9 - 32",
                                               "168 - 197",
                                               "Height By Reflection",
                                               "182 - 188",
                                               "14 - 30",
                                               "Height By Reflection",
                                               "Height By Reflection",
                                               "9 - 48",
                                               "20 - 86",
                                               "9",
                                               "125",
                                               "8 - 32",
                                               "176 - 187",
                                               "Height By Reflection",
                                               "-3 - 7",
                                               "-29 - 32"),
                    FLIGHT_HEIGHT_METHOD_ID=c(1,1,1,1,1,1,1,1,1,1,
                                              1,1,1,1,1,1,1,1,1,1,
                                              1,1,1,1,1,1,1,1,1,1,
                                              1,1, 1,1,1,1,1,1,1,1,
                                              1,1,1,1,1,1,1,1,1,1,1,
                                              1,1,1,1,1,1,1,1,3,1,1,
                                              2,3,1,1,1,1,1,1,1,3,1,
                                              2,2,3,1,1,1,2,1,1,1,1,
                                              1,1,1,1,1,1,1,1,1,1,1,
                                              1,1,1,3,1,1,3,1,1,3,3,
                                              1,1,1,1,1,1,3,1,1,2,1,
                                              3,3,3,3,3,3,3,3,3,2,2,
                                              2,2))
```

```{r}
HEIGHTS<-HEIGHTS %>%
  mutate(OBSERVATION=as.character(OBSERVATION))%>%
  left_join(EURINGS,by='OBSERVATION')%>%
  mutate(ENGLISH_NAME_CONTROL_ID=ENGLISH_NAME,
         ENGLISH_NAME_BEFORE_CONTROL=ENGLISH_NAME,
         ID_MATCH_MISMATCH=1)%>%
  relocate(OBSERVATION,ENGLISH_NAME_BEFORE_CONTROL,ENGLISH_NAME_CONTROL_ID,ID_MATCH_MISMATCH,ENGLISH_NAME,
           ACTIVITY,FLIGHT_HEIGHT,FLIGHT_HEIGHT_CONFIDENCE,FLIGHT_HEIGHT_METHOD_ID)
```

# ~~~~~~~~~~~~~~~

# Merge

```{r}
COLUMNS_FILLED1<-bind_rows(COLUMN_NAMES,
                           ABIOTIC_STRUCTURES,
                           ABIOTIC_OBSERVATIONS,
                           OBSERVATION10,
                           ENGLISH_NAME_BEFORE_CONTROL10,
                           BEHAVIOURS,
                           ACTIVITIES,
                           FAMILY_GROUPS,
                           ASSOCIATIONS,
                           SUBMERGEDS,
                           AGE_CLASSES,
                           PLUMAGES,
                           SEXS,
                           LENGHTS,
                           WINGS,
                           HEIGHTS)
```


# Random assigments

## Detection Step

```{r}
max_row<-nrow(COLUMNS_FILLED1)
max_row*0.05
max_row*0.2
DETECTION_STEPS <- data.frame(DETECTION_STEP=c(rep(NA,each=max_row))) #70% not audited
DETECTION_STEPS$DETECTION_STEP[floor(runif(110, min=0, max=max_row))]<-1 #screener 5%
DETECTION_STEPS$DETECTION_STEP[floor(runif(120, min=0, max=max_row))]<-2 #auditor 5%
DETECTION_STEPS$DETECTION_STEP[floor(runif(500, min=0, max=max_row))]<-3 #agreement 20%
```

```{r}
COLUMNS_FILLED2<-COLUMNS_FILLED1 %>%
  mutate(DETECTION_STEP=DETECTION_STEPS$DETECTION_STEP)
```

```{r}
COLUMNS_FILLED2 %>%
  group_by(DETECTION_STEP)%>%
  tally()%>%
  mutate(TOTAL=sum(n),
         PROP=n*100/TOTAL)
```

## Match Mismatch

```{r}
COLUMNS_FILLED2 %>% #check % of match expected
  group_by(ID_MATCH_MISMATCH)%>%
  tally()%>%
  mutate(TOTAL=sum(n),
         PROP=n*100/TOTAL)
```

## Activity

```{r}
COLUMNS_FILLED2 %>% #check % of match expected
  group_by(ACTIVITY)%>%
  tally()%>%
  mutate(TOTAL=sum(n),
         PROP=n*100/TOTAL)
```

```{r}
Mammals_cant_fly<-(seamonas::Code_Euring %>%
  select(English_name,Artificial_tax_class)%>%
  filter(Artificial_tax_class=='Marine_mammals'))$English_name
```

```{r}
COLUMNS_FILLED3<-COLUMNS_FILLED2 %>%
  mutate(ACTIVITY = case_when(is.na(ACTIVITY)%in% Mammals_cant_fly ~ 1,
                              TRUE ~ ACTIVITY))%>%
  mutate(ACTIVITY = case_when(is.na(ACTIVITY) ~ round(runif(is.na(ACTIVITY), min = 1, max = 2)),
                              TRUE ~ ACTIVITY))
```

```{r}
#It depends but often is balanced between swimming and flying
COLUMNS_FILLED3 %>%
  group_by(ACTIVITY)%>%
  tally()%>%
  mutate(TOTAL=sum(n),
         PROP=n*100/TOTAL)
```

## Heading

```{r}
max_row<-nrow(COLUMNS_FILLED3)
max_row*0.4/6
HEADINGS<- data.frame(HEADING=c(rep(NA,each=max_row))) #60% No Heading information
HEADINGS$HEADING[floor(runif(200, min=0, max=max_row))]<-45 
HEADINGS$HEADING[floor(runif(200, min=0, max=max_row))]<-90 
HEADINGS$HEADING[floor(runif(200, min=0, max=max_row))]<-135 
HEADINGS$HEADING[floor(runif(200, min=0, max=max_row))]<-180
HEADINGS$HEADING[floor(runif(200, min=0, max=max_row))]<-270
HEADINGS$HEADING[floor(runif(200, min=0, max=max_row))]<-315
```

```{r}
COLUMNS_FILLED3$HEADING<-HEADINGS$HEADING
```


# Observation_ID

```{r}
COLUMNS_FILLED4<-COLUMNS_FILLED3 %>%
  mutate(CRUISENO='AreaA_Summer_2025')
```

```{r}
COLUMNS_FILLED4$OBSERVATION_ID<-sample(1:nrow(COLUMNS_FILLED4), nrow(COLUMNS_FILLED4), replace = FALSE)
```

# Position_ID

```{r}
POSITION_IDS<-seamonas::BasisDaten_test %>%
  select(POSITION_ID,LAT_PIC_CENTER,LON_PIC_CENTER)
```

```{r}
POSITION_IDS <- POSITION_IDS %>% slice_sample(n = nrow(COLUMNS_FILLED4))
```

# Latitude and Longitude

```{r}
COLUMNS_FILLED5 <-COLUMNS_FILLED4 %>%
  mutate(POSITION_ID=POSITION_IDS$POSITION_ID,
         LAT_OBJECT=POSITION_IDS$LAT_PIC_CENTER,
         LON_OBJECT=POSITION_IDS$LON_PIC_CENTER)
```

Variation

```{r}
COLUMNS_FILLED6 <-COLUMNS_FILLED5 %>%
  mutate(LAT_OBJECT=POSITION_IDS$LAT_PIC_CENTER+runif(2116, min=0, max=0.001),
         LON_OBJECT=POSITION_IDS$LON_PIC_CENTER+runif(2116, min=0, max=0.001))
```

# Save

```{r}
Observations_test<-COLUMNS_FILLED6
```

```{r}
save(Observations_test, file = "Observations_test.RData", version = 2)
```

# ~~~~~~~~~~~~~~

# Code_Descriptions

# Save

```{r}
save(Code_Descriptions, file = "Code_Descriptions.RData", version = 2)
```

# ~~~~~~~~~~~~~~

# Description_Explanation




